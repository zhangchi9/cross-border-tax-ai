{
    "gating_questions": {
        "title": "Gating questions",
        "description": "Initial screening questions to determine which modules apply",
        "questions": [
            {
                "id": "us_person_check",
                "question": "Are you a U.S. citizen or U.S. green-card holder?",
                "action": " if yes, go to Module A — Residency & Elections"
            },
            {
                "id": "canadian_resident_check",
                "question": "For this tax year, are you a Canadian tax resident (or unsure about your residency status)?",
                "action": " if yes, go to Module A — Residency & Elections"
            },
            {
                "id": "cross_border_move",
                "question": "Did you move between the U.S. and Canada this year, or spend significant time in the other country (e.g., >183 days)?",
                "action": " if yes, go to Module A — Residency & Elections"
            },
            {
                "id": "treaty_benefits",
                "question": "Do you plan to claim any treaty benefits or elections (e.g., tie-breaker rules, first-year or dual-status elections)?",
                "action": " if yes, go to Module A — Residency & Elections"
            },
            {
                "id": "us_employment",
                "question": "Did you earn employment or contractor income in the U.S. at any time this year?",
                "action": " if yes, go to Module B — Employment & U.S. States"
            },
            {
                "id": "canada_employment",
                "question": "Did you earn employment or contractor income in Canada at any time this year?",
                "action": " if yes, go to Module B — Employment & U.S. States"
            },
            {
                "id": "multi_state_work",
                "question": "Did you live in one U.S. state and work in another, or work in multiple U.S. states?",
                "action": " if yes, go to Module B — Employment & U.S. States"
            },
            {
                "id": "business_entity",
                "question": "Do you own or control a business or entity (sole prop, partnership, corporation, LLC/ULC) in the U.S. or Canada?",
                "action": " if yes, go to Module C — Business & Entities"
            },
            {
                "id": "foreign_corporation",
                "question": "Do you own 10% or more of a foreign corporation/partnership or have a controlled foreign affiliate?",
                "action": " if yes, go to Module C — Business & Entities"
            },
            {
                "id": "real_estate",
                "question": "Did you own, buy, sell, or rent out real estate (home, rental, vacation property) in the U.S. or Canada this year?",
                "action": " if yes, go to Module D — Real Estate"
            },
            {
                "id": "housing_related",
                "question": "Do you want to claim housing-related items (principal residence, moving expenses, home office, or foreign housing exclusions/deductions)?",
                "action": " if yes, go to Module D — Real Estate"
            },
            {
                "id": "financial_accounts",
                "question": "Do you hold non-registered financial accounts or investments across the border (bank/brokerage accounts, ETFs/mutual funds, bonds, GICs, crypto) located in the U.S. or Canada?",
                "action": " if yes, go to Module E — Investments & Financial Assets"
            },
            {
                "id": "registered_accounts",
                "question": "Do you have registered accounts or pensions (RRSP, TFSA, RESP, RDSP, 401(k), IRA) or receive government/social benefits (CPP/OAS, EI, U.S. Social Security)?",
                "action": " if yes, go to Module F — Pensions, Savings & Social Benefits"
            },
            {
                "id": "equity_compensation",
                "question": "Did you receive or exercise equity compensation (RSUs, stock options, ESPP/RSAs) from a U.S. or Canadian employer, including during a cross-border move?",
                "action": " if yes, go to Module G — Equity Compensation"
            },
            {
                "id": "gifts_trusts",
                "question": "Did you give or receive large gifts or inheritances, or are you a grantor/beneficiary/trustee of a trust (including Canadian trusts with U.S. reporting)?",
                "action": " if yes, go to Module H — Estates, Gifts & Trusts"
            },
            {
                "id": "information_reports",
                "question": "Do you need to file information reports or fix past issues (FBAR/FinCEN 114, IRS Form 8938, CRA T1135, PFIC Form 8621, Forms 3520/3520-A/5471/8865/8858)?",
                "action": " if yes, go to Module I — Reporting & Cleanup"
            },
            {
                "id": "amend_returns",
                "question": "Do you need to amend prior-year returns or respond to tax notices/assessments from the IRS or CRA?",
                "action": " if yes, go to Module I — Reporting & Cleanup"
            },
            {
                "id": "missed_filings",
                "question": "Did you miss any required filings in prior years (e.g., late FBAR/8938/T1135) and want to use a voluntary disclosure/streamlined path?",
                "action": " if yes, go to Module I — Reporting & Cleanup"
            }
        ]
    },
    "modules": {
        "residency_elections": {
            "id": "module_a",
            "title": "Module A — Residency & Elections",
            "questions": [
                {
                    "id": "a1_substantial_presence",
                    "question": "U.S. day-count: Did you meet the U.S. Substantial Presence Test (≥ 31 U.S. days this year and 183 weighted total using 1, 1/3, 1/6 rule)?",
                    "action": " if yes, add tag: U.S. resident by Substantial Presence Test"
                },
                {
                    "id": "a2_snowbird",
                    "question": "Snowbird: Did you spend time in the United States this year but maintain a closer connection to Canada and intend to remain a Canadian tax resident?",
                    "action": " if yes, add tag: Snowbird with closer connection to Canada (Form 8840)"
                },
                {
                    "id": "a3_residency_change",
                    "question": "Residency change: Did you start or cease Canadian or U.S. tax residency at any time this year (immigration/emigration/dual-status)?",
                    "action": " if yes, add tag: Residency change / dual-status year (departure tax & tie-breaker rules)"
                },
                {
                    "id": "a4_treaty_position",
                    "question": "Treaty position: Will you claim a treaty-based position that changes the default result (e.g., Article IV tie-breaker, Article XV short-stay wage exemption, or closer-connection claim)?",
                    "action": " if yes, add tag: Treaty-based position disclosure (Form 8833 likely required)"
                }
            ]
        },
        "employment_states": {
            "id": "module_b",
            "title": "Module B — Employment & U.S. States",
            "questions": [
                {
                    "id": "b1_work_performed",
                    "section": "Work performed while present",
                    "subquestions": [
                        {
                            "id": "b1_canada_to_us",
                            "question": "Canada → United States: On any day, did you perform work while physically in the United States?",
                            "action": " if yes, add tag: Wages taxable in the United States based on U.S. workdays (source-country wages)"
                        },
                        {
                            "id": "b1_us_to_canada",
                            "question": "U.S. → Canada: On any day, did you perform work while physically in Canada?",
                            "action": " if yes, add tag: Wages taxable in Canada based on Canadian workdays (source-country wages)"
                        }
                    ]
                },
                {
                    "id": "b2_treaty_short_stay",
                    "section": "Treaty short-stay test (answer per direction, if B1 = Yes)",
                    "subquestions": [
                        {
                            "id": "b2_us_workdays",
                            "question": "U.S. workdays (Canada → U.S.) meet all three? (≤ 183 U.S. days in relevant 12-month period; employer not U.S. resident; pay not borne by a U.S. PE/fixed base)",
                            "action": " if yes, add tag: Short-stay treaty exemption for wages (United States)"
                        },
                        {
                            "id": "b2_canadian_workdays",
                            "question": "Canadian workdays (U.S. → Canada) meet all three? (≤ 183 Canadian days; employer not Canadian resident; pay not borne by a Canadian PE/fixed base)",
                            "action": " if yes, add tag: Short-stay treaty exemption for wages (Canada)"
                        }
                    ]
                },
                {
                    "id": "b3_remote_work",
                    "section": "Remote work from home (no travel)",
                    "subquestions": [
                        {
                            "id": "b3_canada_to_us",
                            "question": "Canada → U.S.: Do you perform services entirely or almost entirely in Canada for a U.S. employer?",
                            "action": " if yes, add tag: Remote work performed in Canada for U.S. employer (sourcing & FTC coordination)"
                        },
                        {
                            "id": "b3_us_to_canada",
                            "question": "U.S. → Canada: Do you perform services entirely or almost entirely in the United States for a Canadian employer?",
                            "action": " if yes, add tag: Remote work performed in the United States for Canadian employer (sourcing & FTC coordination)"
                        }
                    ]
                },
                {
                    "id": "b4_state_rules",
                    "question": "U.S. state rules: Did a \"convenience of the employer\" state (e.g., NY/CT/DE/NE) apply to you for remote work?",
                    "action": " if yes, add tag: State convenience-of-employer exposure"
                },
                {
                    "id": "b5_state_filing",
                    "question": "U.S. state filing: Will you have a U.S. state income tax return where rules may differ from federal treaty/credit rules?",
                    "action": " if yes, add tag: State nonconformity with treaty/FTC"
                },
                {
                    "id": "b6_social_taxes",
                    "question": "Social taxes (both directions): Will you use a certificate of coverage under the U.S.–Canada Totalization Agreement to avoid double social security (CPP/EI vs FICA)?",
                    "action": " if yes, add tag: Social security Totalization & certificate of coverage"
                },
                {
                    "id": "b7_canada_payroll",
                    "question": "Canada payroll relief (nonresident employer): Do you need Canada Reg. 102/105 waivers or nonresident-employer certification for services performed in Canada?",
                    "action": " if yes, add tag: Canada Reg. 102/105 waivers & nonresident-employer certification"
                }
            ]
        },
        "business_entities": {
            "id": "module_c",
            "title": "Module C — Business & Entities",
            "questions": [
                {
                    "id": "c1_us_person_canadian_corp",
                    "question": "U.S. person → Canadian company: As a U.S. person, did you own (directly/indirectly) ≥ 10% of a Canadian corporation or otherwise control it?",
                    "action": " if yes, add tag: U.S. shareholder of Canadian corporation (Forms 5471; GILTI/Subpart F)"
                },
                {
                    "id": "c2_canadian_us_llc",
                    "question": "Canadian resident → U.S. LLC: As a Canadian resident, did you own any interest in a U.S. LLC (single- or multi-member)?",
                    "action": " if yes, add tag: Canadian resident owning U.S. LLC (entity classification mismatch planning)"
                },
                {
                    "id": "c3_canadian_us_s_corp",
                    "question": "Canadian owner of U.S. S-corp: Are you a Canadian owner/investor in a U.S. S-corporation (or planning to be)?",
                    "action": " if yes, add tag: S-corporation shareholder ineligibility for Canadian owners (planning required)"
                },
                {
                    "id": "c4_canadian_gst_hst",
                    "question": "Canadian indirect tax: Do you likely need to register for Canadian GST/HST for sales/services to Canadian customers?",
                    "action": " if yes, add tag: Canadian GST/HST registration (place-of-supply rules)"
                },
                {
                    "id": "c5_us_sales_tax",
                    "question": "U.S. sales/use tax: Do you have U.S. sales/use tax exposure due to economic nexus or presence in any U.S. state?",
                    "action": " if yes, add tag: U.S. state sales/use tax nexus"
                }
            ]
        },
        "real_estate": {
            "id": "module_d",
            "title": "Module D — Real Estate (Ownership, Rental, Sales, Housing)",
            "questions": [
                {
                    "id": "d1_canadian_us_rental",
                    "question": "Canada → United States (rental): Are you a Canadian resident who owns U.S. rental property (including short-term rentals)?",
                    "action": " if yes, add tag: Canadian resident owning U.S. rental property (Form 1040-NR; §871(d) net election vs 30% gross; W-8ECI)"
                },
                {
                    "id": "d2_us_canadian_rental",
                    "question": "U.S. (person/resident) → Canada (rental): Are you a U.S. person or Canadian nonresident who owns Canadian rental property (including short-term rentals)?",
                    "action": " if yes, add tag: U.S. person/nonresident with Canadian rental (section 216 net-income return)"
                },
                {
                    "id": "d3_selling_us",
                    "question": "Selling in the U.S.: Did you (as a non-U.S. resident) sell U.S. real property this year or have a sale pending?",
                    "action": " if yes, add tag: Sale of U.S. real property (non-resident) — FIRPTA withholding & 1040-NR true-up (consider Form 8288-B for reduced withholding)"
                },
                {
                    "id": "d4_selling_canada",
                    "question": "Selling in Canada: Did you (as a nonresident of Canada or as a U.S. person) sell Canadian real property this year or have a sale pending?",
                    "action": " if yes, add tag: Sale of Canadian real property (non-resident/U.S. person) — CRA T2062 clearance & nonresident return"
                },
                {
                    "id": "d5_home_sale",
                    "question": "Home sale rules: Was a sold property your home, and are you relying on a principal-residence / U.S. §121 exclusion?",
                    "action": " if yes, add tag: Cross-border principal-residence / U.S. §121 coordination"
                },
                {
                    "id": "d6_vacancy_speculation",
                    "question": "Vacancy/speculation: Is your Canadian property subject to local vacancy/speculation/empty-homes taxes?",
                    "action": " if yes, add tag: Local vacancy/speculation tax exposure"
                },
                {
                    "id": "d7_uht",
                    "question": "UHT: Do you own Canadian residential property that may be caught by the federal Underused Housing Tax rules?",
                    "action": " if yes, add tag: Underused Housing Tax (UHT-2900 filing)"
                }
            ]
        },
        "investments_financial": {
            "id": "module_e",
            "title": "Module E — Investments & Financial Assets (U.S. ↔ Canada only)",
            "questions": [
                {
                    "id": "e1_canada_us_income",
                    "question": "Canada → United States income: As a Canadian resident, did you receive U.S.-source dividends, interest, or royalties this year?",
                    "action": " if yes, add tag: U.S. investment income received by Canadian resident (treaty withholding + Canadian foreign tax credit)"
                },
                {
                    "id": "e2_us_canada_income",
                    "question": "U.S. (person/resident) → Canada income: As a U.S. person or Canadian nonresident, did you receive Canadian-source investment income this year?",
                    "action": " if yes, add tag: Canadian investment income received by U.S. person/nonresident (withholding + U.S./nonresident reporting)"
                },
                {
                    "id": "e3_pfic",
                    "question": "PFIC (U.S. persons): As a U.S. person, did you hold Canadian mutual funds/ETFs or other non-U.S. pooled funds?",
                    "action": " if yes, add tag: PFIC reporting for Canadian funds (Form 8621)"
                },
                {
                    "id": "e4_accounts",
                    "section": "Accounts across the border",
                    "subquestions": [
                        {
                            "id": "e4_canada_to_us",
                            "question": "Canada → United States: Do you hold U.S. bank/brokerage/retirement/crypto accounts?"
                        },
                        {
                            "id": "e4_us_to_canada",
                            "question": "U.S. → Canada: Do you hold Canadian bank/brokerage/retirement/crypto accounts?",
                            "action": " if yes, add tag: Cross-border financial accounts (reporting and withholding documentation)"
                        }
                    ]
                },
                {
                    "id": "e5_withholding_paperwork",
                    "question": "Withholding paperwork: Do you need to furnish/update W-8BEN / W-8ECI / W-9 / CRA NR forms with payers?",
                    "action": " if yes, add tag: Withholding documentation maintenance (W-8/W-9/NR forms)"
                }
            ]
        },
        "pensions_savings": {
            "id": "module_f",
            "title": "Module F — Pensions, Savings & Social Benefits",
            "questions": [
                {
                    "id": "f1_cross_border_retirement",
                    "question": "Cross-border retirement plans: Do you hold/contribute to RRSP/RRIF, 401(k), or IRA across the border, or did you take distributions this year?",
                    "action": " if yes, add tag: Cross-border retirement plans (RRSP/RRIF/401(k)/IRA) — deferral, treaty, reporting"
                },
                {
                    "id": "f2_tfsa_resp",
                    "question": "TFSA/RESP (U.S. persons): Are you a U.S. person with a TFSA or RESP?",
                    "action": " if yes, add tag: TFSA/RESP held by U.S. person — U.S. reporting"
                },
                {
                    "id": "f3_social_benefits",
                    "question": "Social benefits while abroad: Do you receive U.S. Social Security or Canadian CPP/OAS while living in the other country?",
                    "action": " if yes, add tag: Cross-border social benefits (treaty allocation and exemptions)"
                },
                {
                    "id": "f4_plan_transfers",
                    "question": "Plan transfers: Do you plan to move/roll retirement funds across the border (directly or indirectly)?",
                    "action": " if yes, add tag: Cross-border pension rollovers/transfers (planning needed)"
                }
            ]
        },
        "equity_compensation": {
            "id": "module_g",
            "title": "Module G — Equity Compensation",
            "questions": [
                {
                    "id": "g1_cross_border_workdays",
                    "question": "Cross-border workdays: Do your options/RSUs/ESPP have grant/vest/exercise/sale periods that include workdays in both the United States and Canada?",
                    "action": " if yes, add tag: Equity compensation with cross-border workdays (allocation & foreign tax credits)"
                },
                {
                    "id": "g2_detail_checks",
                    "question": "Detail checks: Do you hold ISOs/NQSOs/ESPP that may require detailed sourcing or AMT checks (for ISOs)?",
                    "action": " if yes, add tag: Detailed option/ESPP/ISO allocation and ISO AMT review"
                }
            ]
        },
        "estates_gifts_trusts": {
            "id": "module_h",
            "title": "Module H — Estates, Gifts & Trusts",
            "questions": [
                {
                    "id": "h1_estate_exposure",
                    "question": "Estate exposure (Canada → U.S.): As a Canadian (non-U.S. resident), do you own U.S.-situs assets (U.S. real estate, U.S. company shares, certain U.S. financial assets) that could face U.S. estate tax?",
                    "action": " if yes, add tag: U.S. estate tax exposure for nonresident alien (Form 706-NA; treaty relief)"
                },
                {
                    "id": "h2_us_gifts",
                    "question": "U.S. gifts: Are you making gifts that may require a U.S. gift tax return (you are a U.S. person making large gifts, or gifting U.S.-situs assets)?",
                    "action": " if yes, add tag: U.S. gift tax return requirement (Form 709)"
                },
                {
                    "id": "h3_trusts",
                    "question": "Trusts with cross-border ties: Do you create, receive from, or act as trustee/beneficiary of a trust with U.S.–Canada parties or assets?",
                    "action": " if yes, add tag: Cross-border trusts (U.S. Forms 3520/3520-A; Canadian T3 issues)"
                }
            ]
        },
        "reporting_cleanup": {
            "id": "module_i",
            "title": "Module I — Reporting & Cleanup",
            "questions": [
                {
                    "id": "i1_fbar",
                    "question": "FBAR (U.S. persons): If you are a U.S. person, did your non-U.S. accounts (including Canadian) total over USD $10,000 at any time this year?",
                    "action": " if yes, add tag: FBAR foreign account reporting (FinCEN 114)"
                },
                {
                    "id": "i2_fatca",
                    "question": "FATCA (U.S. persons): If you are a U.S. person, do your foreign financial assets (including Canadian) exceed Form 8938 thresholds?",
                    "action": " if yes, add tag: FATCA Form 8938 reporting"
                },
                {
                    "id": "i3_t1135",
                    "question": "T1135 (Canadian residents): If you are a Canadian resident, did the cost of your specified foreign property (including U.S. assets) exceed CAD $100,000 at any time this year?",
                    "action": " if yes, add tag: Canada T1135 foreign property reporting"
                },
                {
                    "id": "i4_late_filings",
                    "question": "Late filings: Do you have late or missed filings (returns, FBAR/8938/T1135, info forms) needing an amnesty/disclosure path?",
                    "action": " if yes, add tag: Compliance relief programs (IRS Streamlined / CRA Voluntary Disclosures)"
                }
            ]
        }
    }
}